openapi: 3.0.3
info:
  title: Astro Vision — Core REST
  version: 1.0.0
  description: Natal, Reports, and Compatibility endpoints with best-practice metadata.

security:
  - bearerAuth: []

tags:
  - name: Natal
  - name: Reports
  - name: Compatibility

paths:
  /:
    get:
      summary: Landing
      operationId: landing
      security: []
      responses:
        '200':
          description: Service landing payload
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '500': { $ref: '#/components/responses/ServerError' }

  /healthz:
    get:
      summary: Liveness probe
      operationId: healthz
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '500': { $ref: '#/components/responses/ServerError' }

  /readyz:
    get:
      summary: Readiness probe
      operationId: readyz
      security: []
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '500': { $ref: '#/components/responses/ServerError' }

  # ============================
  # NATAL
  # ============================
  /api/natal/build-chart:
    post:
      tags: [Natal]
      summary: Build Natal Chart (positions, signs, houses)
      operationId: buildNatalChart
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LifeEventPayload' }
            examples:
              sample:
                value:
                  name: "Amit"
                  dateOfBirth: "1991-07-14"
                  timeOfBirth: "22:35:00"
                  placeOfBirth: "Mumbai, IN"
                  timeZone: "Asia/Kolkata"
                  latitude: 19.0760
                  longitude: 72.8777
      responses:
        '200':
          description: Chart computed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NatalChartOut' }
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/Unprocessable'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/natal/dignities-table:
    post:
      tags: [Natal]
      summary: Compute Dignities Table
      operationId: computeDignitiesTable
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LifeEventPayload' }
      responses:
        '200':
          description: Dignities table
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DignitiesOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/natal/aspects:
    post:
      tags: [Natal]
      summary: Compute Natal Aspects
      operationId: computeNatalAspects
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BirthPayload' }
      responses:
        '200':
          description: Natal aspects dictionary
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NatalAspectsOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/natal/characteristics:
    post:
      tags: [Natal]
      summary: Compute Natal Characteristics & KPI summary
      operationId: computeNatalCharacteristics
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BirthPayload' }
      responses:
        '200':
          description: Characteristics and narrative
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NatalCharacteristicsOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  # ============================
  # REPORTS
  # ============================
  /api/reports/life-events:
    post:
      tags: [Reports]
      summary: Major & minor life events (summary windows)
      operationId: reportLifeEvents
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LifeEventPayload' }
      responses:
        '200':
          description: Life events dictionary
          content:
            application/json:
              schema: { $ref: '#/components/schemas/LifeEventsOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/reports/timeline:
    post:
      tags: [Reports]
      summary: Report timeline (1y/6m/1m) with aspect windows and AI summary
      operationId: reportTimeline
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TimelineRequest' }
      responses:
        '200':
          description: Full timeline
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TimelineOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/reports/daily-weekly:
    post:
      tags: [Reports]
      summary: Daily/Weekly prediction update
      operationId: dailyWeeklyPrediction
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TimelineRequest' }
      responses:
        '200':
          description: Short summary + key areas
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DailyWeeklyOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/reports/upcoming-events:
    post:
      tags: [Reports]
      summary: Upcoming major/minor events with categories
      operationId: upcomingEvents
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LifeEventPayload' }
      responses:
        '200':
          description: Upcoming events
          content:
            application/json:
              schema: { $ref: '#/components/schemas/UpcomingEventsCalendarOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  # ============================
  # COMPATIBILITY
  # ============================
  /api/compat/synastry:
    post:
      tags: [Compatibility]
      summary: Compatibility finder (pairwise)
      operationId: compatibilityFinder
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CompatibilityPairIn' }
            examples:
              sample:
                summary: Sample (matches CompatibilityPairIn)
                value:
                  person1:
                    name: "Amit"
                    dateOfBirth: "1991-07-14"
                    timeOfBirth: "22:35:00"
                    placeOfBirth: "Mumbai, IN"
                    timeZone: "Asia/Kolkata"
                    latitude: 19.0760
                    longitude: 72.8777
                  person2:
                    name: "Riya"
                    dateOfBirth: "1993-02-20"
                    timeOfBirth: "06:10:00"
                    placeOfBirth: "Delhi, IN"
                    timeZone: "Asia/Kolkata"
                    latitude: 28.6139
                    longitude: 77.2090
                  type: "General"
      responses:
        '200':
          description: Compatibility KPIs, total score, summary
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CompatibilityOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/compat/group:
    post:
      tags: [Compatibility]
      summary: Group compatibility analysis (up to 10 people)
      operationId: groupCompatibility
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/GroupCompatibilityIn' }
      responses:
        '200':
          description: Pairwise matrix + group harmony + total score
          content:
            application/json:
              schema: { $ref: '#/components/schemas/GroupCompatibilityOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/compat/soulmate-finder:
    post:
      tags: [Compatibility]
      summary: Soulmate finder (returns candidate DOBs)
      operationId: soulmateFinder
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BirthPayload' }
      responses:
        '200':
          description: List of compatible date(s) of birth
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SoulmateOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

  /api/compat/ashtakoota:
    post:
      tags: [Compatibility]
      summary: Vedic Ashtakoota (Gun Milan) score and explanation
      operationId: compatAshtakoota
      parameters:
        - $ref: '#/components/parameters/XCorrelationID'
        - $ref: '#/components/parameters/XTransactionId'
        - $ref: '#/components/parameters/XSessionId'
        - $ref: '#/components/parameters/Authorization'
        - $ref: '#/components/parameters/XAppId'
        - name: ayanamsa
          in: query
          required: false
          schema:
            type: string
            enum: ["lahiri","krishnamurti","raman"]
            default: "lahiri"
        - name: coordinate_system
          in: query
          required: false
          schema:
            type: string
            enum: ["sidereal","tropical"]
            default: "sidereal"
        - name: strict_tradition
          in: query
          required: false
          schema:
            type: boolean
            default: true
        - name: use_exceptions
          in: query
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CompatibilityPairIn' }
            examples:
              sample:
                summary: Sample (matches CompatibilityPairIn)
                value:
                  person1:
                    name: "Amit"
                    dateOfBirth: "1991-07-14"
                    timeOfBirth: "22:35:00"
                    placeOfBirth: "Mumbai, IN"
                    timeZone: "Asia/Kolkata"
                    latitude: 19.0760
                    longitude: 72.8777
                  person2:
                    name: "Riya"
                    dateOfBirth: "1993-02-20"
                    timeOfBirth: "06:10:00"
                    placeOfBirth: "Delhi, IN"
                    timeZone: "Asia/Kolkata"
                    latitude: 28.6139
                    longitude: 77.2090
                  type: "Marriage"
      responses:
        '200':
          description: Gun Milan score with explanation
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AshtakootaOut' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '404': { $ref: '#/components/responses/NotFound' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '500': { $ref: '#/components/responses/ServerError' }

components:
  # ---------- Security ----------
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  # ---------- Common Headers (Metadata) ----------
  parameters:
    XCorrelationID:
      name: X-Correlation-ID
      in: header
      required: true
      schema:
        type: string
        default: "11111111-2222-3333-4444-555555555555"
      description: Client-generated request id for idempotency/trace (uuid). Default provided for sandbox testing.
    XSessionId:
      name: X-Session-ID
      in: header
      required: true
      schema:
        type: string
        default: "sess-demo-01"
      description: Client session identifier. Default provided for sandbox testing.
    XTransactionId:
      name: X-Transaction-ID
      in: header
      required: true
      schema:
        type: string
        default: "txn-demo-01"
      description: Server-generated transaction id echoed back. Default provided for sandbox testing.
    Authorization:
      name: Authorization
      in: header
      required: true
      schema:
        type: string
        default: "Bearer demo-token"
      description: Bearer token for authentication.
    XAppId:
      name: X-App-ID
      in: header
      required: true
      schema:
        type: string
        default: "sandbox-client"
      description: Calling application id/client key. Default provided for sandbox testing.

  # ---------- Standard responses ----------
  responses:
    BadRequest:
      description: Invalid input payload
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorResponse' }
          example:
            error:
              code: "BAD_REQUEST"
              message: "Invalid input payload. Required field 'dateOfBirth' is missing."
              details:
                - issue: "Field 'dateOfBirth' is required"
    Unauthorized:
      description: Missing/invalid authentication
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorResponse' }
          example:
            error:
              code: "UNAUTHORIZED"
              message: "Authentication credentials are missing or invalid."
    NotFound:
      description: Not found
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorResponse' }
          example:
            error:
              code: "NOT_FOUND"
              message: "Not Found"
    Unprocessable:
      description: Semantically invalid (e.g., impossible birth time/zone)
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorResponse' }
          example:
            error:
              code: "UNPROCESSABLE_ENTITY"
              message: "Birth time and timezone combination is not possible."
    ServerError:
      description: Unexpected server error
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorResponse' }
          example:
            error:
              code: "SERVER_ERROR"
              message: "An unexpected error occurred. Please try again later."

  # ---------- Schemas ----------
  schemas:

    ErrorDetail:
      type: object
      properties:
        field:
          type: string
          nullable: true
        issue:
          type: string
          nullable: true

    ErrorEnvelope:
      type: object
      required: [code, message]
      properties:
        code: { type: string, example: "BAD_REQUEST" }
        message: { type: string }
        details:
          type: array
          nullable: true
          items: { $ref: '#/components/schemas/ErrorDetail' }

    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          $ref: '#/components/schemas/ErrorEnvelope'

    SuccessEnvelope:
      type: object
      description: Standard success wrapper returning every payload under a top-level `data` key.
      required: [data]
      properties:
        data:
          description: Concrete payload populated per-endpoint schema.
          nullable: true

    BirthPayload:
      type: object
      required:
        - name
        - dateOfBirth
        - timeOfBirth
        - placeOfBirth
        - timeZone
        - latitude
        - longitude
      properties:
        name: { type: string, example: "Amit" }
        dateOfBirth: { type: string, format: date, example: "1980-01-01" }     # YYYY-MM-DD
        timeOfBirth: { type: string, example: "22:35:00" }
        placeOfBirth: { type: string , example: "Mumbai, IN" }
        timeZone: { type: string, example: "Asia/Kolkata" }
        latitude: { type: number, example: 19.0760 }
        longitude: { type: number, example: 72.8777 }
        lang_code: {type: string, example: "en", description: "Optional ISO language code for localized outputs (e.g., 'en', 'hi', 'es'). Defaults to English if not provided." }

    LifeEventPayload:
      allOf:
        - $ref: '#/components/schemas/BirthPayload'
        - type: object
          required: [horizon_days]
          properties:
            start_date:
              type: string
              format: date
              nullable: true
            horizon_days:
              type: integer
              minimum: 1

    TimelineRequest:
      allOf:
        - $ref: '#/components/schemas/BirthPayload'
        - type: object
          required: [timePeriod, reportStartDate]
          properties:
            timePeriod:
              type: string
              enum: ["1Y","6M","1M","1W","1D"]
            reportStartDate:
              type: string
              format: date
            cursor:
              type: string
              nullable: true

    PlanetEntry:
      type: object
      required: [planetName, planetSign, planetDegree, houseNumber]
      properties:
        planetName: { type: string, example: "Sun" }
        planetSign: { type: string, example: "Cancer" }
        planetDegree: { type: number, example: 107.1667, description: "Absolute ecliptic longitude (0–360°)" }
        houseNumber: { type: integer, minimum: 1, maximum: 12 }
        houseName: { type: string, example: "Eighth House" }
        houseSign: { type: string, example: "Cancer" }

    NatalChartData:
      type: object
      required: [planets]
      properties:
        planets:
          type: array
          items: { $ref: '#/components/schemas/PlanetEntry' }

    NatalChartOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/NatalChartData'

    DignityRow:
      type: object
      properties:
        planet: { type: string }
        rulership: { type: boolean }
        exaltation: { type: boolean }
        detriment: { type: boolean }
        fall: { type: boolean }
        essentialScore: { type: number }
        notes: { type: string }

    DignitiesData:
      type: object
      required: [table]
      properties:
        table:
          type: array
          description: Dignities table rows
          items: { $ref: '#/components/schemas/DignityRow' }

    DignitiesOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/DignitiesData'

    NatalAspectItem:
      type: object
      properties:
        aspect: { type: string, example: "Sun trine Moon" }
        angle:
          type: number
          description: Angular separation in degrees
        dist:
          type: number
          description: Distance from exact aspect in degrees
        strength: { type: number }
        characteristics:
          type: object
          additionalProperties: { type: string }

    NatalAspectsOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              type: array
              description: List of natal aspects with strength & characteristics
              items: { $ref: '#/components/schemas/NatalAspectItem' }

    KpiItem:
      type: object
      properties:
        name: { type: string, example: "Leadership" }
        shortDescription: { type: string }

    NatalCharacteristicsData:
      type: object
      required: [description, kpis]
      properties:
        description: { type: string, description: "Narrative natal description" }
        kpis:
          type: array
          items: { $ref: '#/components/schemas/KpiItem' }

    NatalCharacteristicsOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/NatalCharacteristicsData'

    LifeEvent:
      type: object
      properties:
        aspect: { type: string }
        eventType: { type: string, enum: ["MAJOR","MINOR"] }
        timePeriod: { type: string }
        startDate: { type: string, format: date }
        endDate: { type: string, format: date }
        exactDate: { type: string, format: date }
        description: { type: string }

    LifeEventsOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              type: array
              items: { $ref: '#/components/schemas/LifeEvent' }

    TimelineItem:
      type: object
      properties:
        aspect: { type: string, example: "Jupiter sextile Moon" }
        startDate: { type: string, format: date }
        exactDate: { type: string, format: date }
        endDate: { type: string, format: date }
        description: { type: string }
        keyPoints:
          type: object
          additionalProperties:
            type: array
            items: { type: string }
        facets_points:
          type: object
          additionalProperties: { type: string }

    TimelineData:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/TimelineItem' }
        aiSummary:
          type: string
          nullable: true

    TimelineOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/TimelineData'

    DailyArea:
      type: object
      properties:
        keyArea: { type: string, example: "Career" }
        shortDescription: { type: string }

    DailyWeeklyData:
      type: object
      required: [shortSummary, areas]
      properties:
        shortSummary:
          type: object
          properties:
            en: { type: string, description: "English short summary" }
            hi: { type: string, description: "Hindi short summary" }
        areas:
          type: object
          additionalProperties:
            type: object
            properties:
              en:
                type: array
                items: { type: string }
              hi:
                type: array
                items: { type: string }

    DailyWeeklyOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/DailyWeeklyData'

    UpcomingEventWindow:
      type: object
      properties:
        startDate: { type: string, format: date }
        exactDate: { type: string, format: date }
        leaveDate: { type: string, format: date }

    UpcomingEventRow:
      type: object
      properties:
        aspect: { type: string }
        timePeriod:
          $ref: '#/components/schemas/UpcomingEventWindow'
        lifeEvent: { type: string }
        shortDescription: { type: string }
        category:
          type: string
          enum: ["POSITIVE","NEGATIVE"]

    UpcomingEventsOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              type: array
              items: { $ref: '#/components/schemas/UpcomingEventRow' }

    UpcomingCalendarEvent:
      type: object
      required: [aspect, aspectNature, description]
      properties:
        aspect: { type: string }
        aspectNature: { type: string, enum: ["Positive", "Negative"] }
        description:
          description: Plain text or bilingual dict payload.
          oneOf:
            - type: string
            - type: object
              additionalProperties: {}

    UpcomingCalendarDay:
      type: object
      required: [date, events]
      properties:
        date: { type: string, format: date }
        events:
          type: array
          items: { $ref: '#/components/schemas/UpcomingCalendarEvent' }

    UpcomingEventsCalendarOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              type: array
              items: { $ref: '#/components/schemas/UpcomingCalendarDay' }

    PersonPayload:
      type: object
      required:
        - name
        - dateOfBirth
        - timeOfBirth
        - placeOfBirth
        - timeZone
        - latitude
        - longitude
      properties:
        name: { type: string }
        dateOfBirth: { type: string, format: date }
        timeOfBirth: { type: string }
        placeOfBirth: { type: string }
        timeZone: { type: string }
        latitude: { type: number }
        longitude: { type: number }

    CompatibilityPairIn:
      type: object
      required: [person1, person2, type]
      properties:
        person1: { $ref: '#/components/schemas/PersonPayload' }
        person2: { $ref: '#/components/schemas/PersonPayload' }
        type:
          type: string
          enum: ["Marriage","Friendship","Professional","General"]

    KpiScoreRow:
      type: object
      properties:
        kpi: { type: string, example: "Communication" }
        score: { type: number, example: 0.78 }
        description: { type: string }

    CompatibilityData:
      type: object
      required: [kpis, totalScore, summary]
      properties:
        kpis:
          type: array
          items: { $ref: '#/components/schemas/KpiScoreRow' }
        totalScore: { type: number, example: 0.74 }
        summary: { type: string }

    CompatibilityOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CompatibilityData'

    GroupCompatibilityIn:
      type: object
      required: [people, type]
      properties:
        people:
          type: array
          minItems: 2
          maxItems: 10
          items: { $ref: '#/components/schemas/PersonPayload' }
        type:
          type: string
          enum: ["Friendship Group","Professional Team","Sport Team","Family","Relative"]
        cursor:
          type: string
          nullable: true

    PairwiseRow:
      type: object
      properties:
        person1: { type: string }
        person2: { type: string }
        kpi: { type: string }
        score: { type: number }
        description: { type: string }

    GroupCompatibilityData:
      type: object
      required: [pairwise, groupHarmony, totalGroupScore]
      properties:
        pairwise:
          type: array
          items: { $ref: '#/components/schemas/PairwiseRow' }
        groupHarmony:
          type: array
          items: { $ref: '#/components/schemas/KpiScoreRow' }
        totalGroupScore: { type: number }

    GroupCompatibilityOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/GroupCompatibilityData'

    SoulmateData:
      type: object
      required: [datesOfBirth]
      properties:
        datesOfBirth:
          type: array
          items: { type: string, format: date }

    SoulmateOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/SoulmateData'

    AshtakootaData:
      type: object
      required: [result, explanation]
      properties:
        result:
          type: object
          additionalProperties: {}
          description: Detailed Gun Milan breakdown (0–36)
        explanation: { type: string }

    AshtakootaOut:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/AshtakootaData'
